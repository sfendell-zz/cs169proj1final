<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" type="text/css" href="login.css">
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
</head>

<center>
<div id="login-page" class="box">
  <div id="login-message" class="message"></div>
  <center>
    <form>
      Username: <input id="username" type="text" name="username"><br>
      Password: <input id="password" type="password" name="pwd"><br>
      <input id="login-button" type="submit" value="Login">
      <input id="add-button" type="submit" value="Add User">
    </form>
  </center>
</div>

<div id="welcome-page" class="box">
  <div id="welcome-message" class="message"></div>
  <center>
    <form>
      <input type="submit" id="logout-button" value="Logout">
    </form>
  </center>
</div>
</center>

<script type="text/javascript">


ERR_BAD_CREDENTIALS = (-1);
ERR_USER_EXISTS = (-2);
ERR_BAD_USERNAME = (-3);
ERR_BAD_PASSWORD = (-4);


function err_to_message(code) {
    if( code == ERR_BAD_CREDENTIALS) {
        return ("Bad username or password. Try again.");
    } 
    
    if(code == ERR_BAD_PASSWORD){
    	return ("Password should be less than 128 characters! it can be empty!");
    }
    
    if( code == ERR_USER_EXISTS) {
        return ("Username taken. Is it yours? We have no way of recovering your password, so just make another account.");
 
    }
    if(code == ERR_BAD)
    
    if( code == ERR_BAD_USERNAME) {
        return ("The username should be nonempty and less than 128 characters. Try again please.");
   } else {
        alert("THIS SHOULDNT HAPPEN EVER! Got a bad error code");
        /*this shouldn't happen*/
   }
}



$('#login-page').hide()
$('#welcome-page').hide()
$('#username').val("")
$('#password').val("")
$('#login-message').html("Please enter your credentials below")

/* When the document is ready, we show the front page!*/
$(document).ready(function() {
   show_front_page();
 });

/* We basically have two pages that we alternatively show and hide.*/
function show_front_page(message) {
  if(! message) message = "Please login or make a new account!";
  $('#welcome-page').hide()
  $('#username').val("")
  $('#password').val("")
  $('#login-message').html(message)
  $('#login-page').show()
}

function logged_in_page(user, count) {
   $('#login-page').hide();
   $('#welcome-page').show();
   $('#welcome-message').html("Welcome "+user+"<br>You have logged in "+count+" times.");
}

function handle_login_response(data, user) {
  if( data.errCode > 0 ) {
     c = data.count;
     show_welcome_page(user, c);
  } else {
     show_front_page( err_to_message(data.errCode) );  
  }
}

function handle_add_user_response(data, user) {
  if( data.errCode > 0 ) {
     c = data.count;
     show_welcome_page(user, c);
  } else {

     show_front_page( err_to_message(data.errCode) );  
  }
}

$('#login-button').click(function() {
   username = $('#username').val()
   password = $('#password').val()
   json_request("/users/login", { user: username, password: password }, function(data) { return handle_login_response(data, username); }, function(err) { alert('This shouldnt happen!'); });

   return false;
});

$('#add-button').click(function() {
   username = $('#username').val()
   password = $('#password').val()
   json_request("/users/add", { user: username, password: password }, function(data) { return handle_add_user_response(data, username); }, function(err) {alert('Something craaazzyyy happened! so crazy'); });

   return false;
});

$('#logout-button').click(function() {
  show_front_page();

  return false;
});

</script>

<body>
</body>
</html>
